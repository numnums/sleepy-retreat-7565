<% content_for :head do -%>
  <script type='text/javascript' src='https://www.google.com/jsapi'></script>
  <script type='text/javascript'>
    google.load('visualization', '1', {packages:['table']});
    // google.setOnLoadCallback(drawTable);
    
    
    function drawTable() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'First Name');
      data.addColumn('string', 'Last Name');
      data.addColumn('string', 'Gender');
      data.addColumn('string', 'Wears Glasses');
      data.addColumn('string', 'Birthdate');
      data.addColumn('string', 'School');
      data.addColumn('string', 'Room Number');
      data.addColumn('string', 'Class Time');
      data.addColumn('string', 'Class Day');
      data.addColumn('string', 'Parent First Name');
      data.addColumn('string', 'Parent Last Name');
      data.addColumn('string', 'Registration Date');

      <% @students.each do |student| %>
        data.addRow(['<%= link_to student.firstname, student_path(student), data: { toggle: "modal", target: "#modal" , remote: student_path(student)} %>' , '<%= student.lastname %>', '<%= student.gender %>', '<%= student.wearsglasses %>',
          '<%= student.birthdate.strftime("%m-%d-%Y") %>', '<%= student.school.name if student.school %>', '<%= student.classroomdescription if student.classroomdescription %>',
          '<%= student.classroomtime if student.classroomtime %>', '<%= student.classroomday if student.classroomday %>','<%= student.parent.firstname if student.parent %>', '<%= student.parent.lastname if student.parent %>', '<%= student.created_at.strftime("%m-%d-%Y") %>']);
      <% end %>      
      var table = new google.visualization.Table(document.getElementById('table_div'));
      table.draw(data, {showRowNumber: false, allowHtml: true});

      google.visualization.events.addListener(table, 'select', selectHandler);

      function selectHandler(e) {
        var selection = table.getSelection();         /** gets everything that's selected **/
        var item = selection[0];                      /** we only support selecting one at this time, if more than one is selected, we'll just use the first    item **/
        var str = data.getFormattedValue(item.row, 0); /** gets the link stored in the first column of the selected row, ie <a data-remote="/students/29" data-                                                   target="#modal" data-toggle="modal" href="/students/29">Davvy</a>  **/
        var target = $(str).attr("href");   /** from that string, only extract the href attr **/
        $("#modal").load(target, function() {   /** and load that href into the modal.  This is similar to the modal code in application.html.erb **/
          $("#modal").modal("show"); 
        });
      }
  }

  </script>
<% end -%>

<script>
  $(document).ready(function () {
      drawTable();
  });
</script>

<div id="register">
  <div class="container">
    <div class="row-fluid">
      <div class="col-md-12">
        <h1>Listing Students</h1>
        <div id='table_div'></div>
        <br></br>
        <%= link_to "New student", new_student_path, id: "new_student", data: { toggle: "modal", target: "#modal" , remote: new_student_path} , class: 'btn btn-primary'%>
      </div>
    </div>
  </div>
</div>